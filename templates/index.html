{% extends "layout.html" %}
{% block content %}

<section class="card">
  <h2>Txn 1 — View + Insert Reservation</h2>
  <form method="post" action="{{ url_for('txn1') }}" class="grid">
    <label>Zone type<input name="zone_type" value="{{ zone_type }}" /></label>
    <label>customer_id<input name="customer_id" type="number" required value="6" /></label>
    <label>vehicle_id<input name="vehicle_id" type="number" required value="6" /></label>
    <label>start_time<input name="start_time" required value="2026-02-13 10:00:00" /></label>
    <label>end_time<input name="end_time" value="2026-02-13 11:00:00" /></label>
    <label>status<input name="status" value="confirmed" /></label>
    <label>placed_time<input name="placed_time" required value="2026-02-13 09:40:00" /></label>
    <label>channel<input name="channel" value="app" /></label>
    <label>promo_code<input name="promo_code" value="" /></label>
    <label>assigned_at<input name="assigned_at" value="2026-02-13 09:45:00" /></label>
    <label>pickup_condition<input name="pickup_condition" value="clean" /></label>
    <label>pickup_odometer<input name="pickup_odometer" type="number" value="12000" /></label>
    <button type="submit">Run Txn 1</button>
  </form>

  <h3>View output: v_vehicle_latest_location</h3>
  {% if latest and latest|length > 0 %}
    <div class="tablewrap">
      <table>
        <thead>
          <tr>
            {% for k in latest[0].keys() %}<th>{{ k }}</th>{% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in latest %}
            <tr>{% for v in row.values() %}<td>{{ v }}</td>{% endfor %}</tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="muted">No rows (or DB error). Try another zone_type or check DB connection.</p>
  {% endif %}
</section>

<section class="card">
  <h2>Txn 2 — Close Maintenance Ticket (fires trigger)</h2>
  <form method="post" action="{{ url_for('txn2') }}" class="grid">
    <label>vehicle_id<input name="vehicle_id" type="number" required value="10" /></label>
    <label>ticket_no<input name="ticket_no" type="number" required value="1010" /></label>
    <label>closed_at<input name="closed_at" value="2026-02-13 12:00:00" /></label>
    <button type="submit">Run Txn 2</button>
  </form>
  <p class="muted">If your trigger is set up, closing a ticket should set the vehicle status back to <code>available</code>.</p>
</section>

<section class="card">
  <h2>Txn 3 — Delete Reservation</h2>
  <form method="post" action="{{ url_for('txn3') }}" class="grid">
    <label>customer_id<input name="customer_id" type="number" required value="6" /></label>
    <label>vehicle_id<input name="vehicle_id" type="number" required value="6" /></label>
    <label>start_time<input name="start_time" required value="2026-02-13 10:00:00" /></label>
    <label>status<input name="status" value="confirmed" /></label>
    <button type="submit">Run Txn 3</button>
  </form>
</section>

{% endblock %}
